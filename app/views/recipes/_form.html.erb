<div id="recipe-form">
<%= form_for(@recipe) do |f| %>
  <% if @recipe.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@recipe.errors.count, "error") %> prohibited this recipe from being saved:</h2>

      <ul>
      <% @recipe.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :name %>
    <%= f.text_field :name %>
  </div>

  <div class="form-group">
    <%= f.label :link %>
    <%= f.text_field :link %>
  </div>

  <div class="form-group">
  <h5>Steps:</h5>
  <ul id="step-fields">
    <%= f.fields_for :steps do |steps_form| %>
      <h5>Step <%= steps_form.index %></h5>
      List the ingredients involved in this step:
      <ul class="ingredient-fields">
        <%= steps_form.fields_for :ingredients do |ingredients_form| %>
          <li>
            <%= ingredients_form.label :amount %>
            <%= ingredients_form.text_field :amount %>

            <%= ingredients_form.label :unit %>
            <%= ingredients_form.text_field :unit %>

            <%= ingredients_form.label :name %>
            <%= ingredients_form.text_field :name %>

            <%= ingredients_form.check_box :_destroy %>
          </li>
          <li><button class="add-ingredient" data-step-index="<%= steps_form.index %>" data-ing-index="<%= ingredients_form.index + 1 %>">+</button></li>
          <% end %>
      </ul>

      <li>
        <%= steps_form.label :description %>
        <%= steps_form.text_area :description %>

        <%= steps_form.check_box :_destroy %>
      </li>
    <% end %>
  </ul>
  </div>
  <button class="add-step">add step</button></li>

  <div class="form-group">
    <%= f.label "Tags" %>
    <%= f.collection_check_boxes :tag_ids, Tag.all(), :id, :name %>
  </div>

  <div class="form-group">
    <%= f.label :notes %>
    <%= f.text_area :notes %>
  </div>

  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>
</div>

<%= javascript_include_tag 'add_fields.js' %>
